---
title: "COMBINED_Taxi-Analysis"
author: "Steven Chao, Tanaya Kavathekar, Madhuri Yadav, Amna Gul"
date: '`r Sys.Date()`'
output:
  html_document:
    number_sections: true
    toc: true
    fig_width: 7
    fig_height: 4.5
    theme: cosmo
    highlight: tango
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(error = TRUE)
#knitr::opts_chunk$set(echo = TRUE)
# knitr::opts_chunk$set(include = F)
```

```{r basicfcn, include=F}
# can add quietly=T option to the require() function
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
```

```{r load libraries, echo=FALSE}
loadPkg("plyr")
loadPkg("dplyr")
loadPkg("ggplot2")
loadPkg("data.table")
# loadPkg("grid")
# loadPkg("gridExtra")
# loadPkg("egg")
loadPkg("nortest")
loadPkg("corrplot")
```

# Introduction

## Literature Review

## Problem statement
QUESTION: For those who pay tip by credit card, what factors influence the amount of tip given?
Should you pay tip to the taxi driver? If yes, how much?

Analyse the factors which takes place to determine the tip amount paid to the driver

Why?
Benefits?
Use?

Hypothesis:
Factors that can affect tip amount:
1. Vendor service
2. Driver service
3. Location :  (generous locations)
4. duration of day 
5. distance
6. count of passengers
7. weather

# Data preprocessing

## Load data
write where data is collected from 
```{r read data files}
unprocessed_data = read.csv("../Data/trips_zones_20000_v2.csv")
taxi_zones <- read.csv("../Data/taxi_zone_lookup.csv")

glimpse(unprocessed_data)

glimpse(taxi_zones)
```

The dataset provides a location ID that corresponds to a taxi zone in each of the five boroughs. These nominal variables do not provide much value in its integer format since we do not know the geographical locations of each location ID. We downloaded a taxi zone and ID dataset that provides the boroughs for each location ID. The dataset also indicates the specific neighborhoods within each borough. We merged that dataset to the taxi dataset to identify the borough for both pick up and drop off.

```{r merge location descriptions}
unprocessed_data <- merge(x = unprocessed_data, y = taxi_zones, by.x = "PULocationID", by.y = "LocationID", all.x = TRUE)

unprocessed_data <- subset(unprocessed_data, select = -c(Zone, service_zone))

colnames(unprocessed_data)[colnames(unprocessed_data)=="Borough"] <- "Borough_pu"

unprocessed_data <- merge(x = unprocessed_data, y = taxi_zones, by.x = "DOLocationID", by.y = "LocationID", all.x = TRUE)

colnames(unprocessed_data)[colnames(unprocessed_data)=="Borough"] <- "Borough_do"
unique(unprocessed_data$Borough_do)

```

## Data statistics 
Looking at the distribution of raw tip amount, it is clear that it is not normally distributed.

```{r tipamount_distr, echo=F, include=T}
boxplot(processed_df$tip_amount)

qqnorm(processed_df$tip_amount)
qqline(processed_df$tip_amount)
```

A normal distribution is often an assumption for many statistical analyses. Generally. raw tip amounts vary because the fare amounts vary. One factor that may not necessarily vary is tipping percentage. In the US, there is often a standardized percentage that a customer gives (for example, 15% at restaurants). We divided the fare amount by the tip amount to obtain a tipping percentage:

per_tip creation

```{r }
# get percentage tip amount
unprocessed_data['per_tip'] = unprocessed_data['tip_amount'] / unprocessed_data['fare_amount'] 
summary(unprocessed_data)
print(sd(processed_df$per_tip))
print(mean(processed_df$per_tip))
```


## Outlier detection and data filters
The dataset comes with an associated data definition guide. 

```{r Outlier detection and missing values, echo=T}

# fare amount in negative & credit card payments
processed_df <- unprocessed_data %>% filter((fare_amount > 0) & (payment_type == 1) & (passenger_count < 7))

# removing outliers:
# per_tip laying outside IQR range in box plot
while (length(boxplot(processed_df$per_tip)$out) != 0){
  dim(processed_df)
  per_tip_outliers <- boxplot(processed_df$per_tip, col = c("#0000FF"))
  processed_df <- processed_df[ !processed_df$per_tip %in% per_tip_outliers$out,]
  dim(processed_df)
}

str(processed_df)
```


##Pickup column

```{r Pickup_time, include=TRUE, echo = FALSE}
processed_df$pickup_datetime <- as.POSIXct(as.character(processed_df$tpep_pickup_datetime), tz = "", format="%m/%d/%Y %H:%M")
processed_df$pickup_time <- format(processed_df$pickup_datetime, format = "%H:%M")
processed_df$pickup_hrs <- format(strptime(processed_df$pickup_time,"%H:%M"),'%H')
processed_df$pickup_hrs_num <- as.numeric(processed_df$pickup_hrs)
processed_df$pickup_time_type <- ifelse(processed_df$pickup_hrs_num >= 05 & processed_df$pickup_hrs_num <= 11, "Morning",
            ifelse(processed_df$pickup_hrs_num > 11 & processed_df$pickup_hrs_num <= 16, "Afternoon",
            ifelse(processed_df$pickup_hrs_num > 16 & processed_df$pickup_hrs_num <= 21, "Evening", "Night")))
processed_df$pickup_time_type <- as.factor(processed_df$pickup_time_type)
processed_df$pickup_time_type <- ordered(processed_df$pickup_time_type, levels = c("Morning", "Afternoon", "Evening", "Night"))
```


## Dropoff column
```{r Dropoff_time, include=TRUE, echo = FALSE}
processed_df$dropoff_datetime <- as.POSIXlt(as.character(processed_df$tpep_dropoff_datetime), tz = "", format="%m/%d/%Y %H:%M")
processed_df$dropoff_time <- format(processed_df$dropoff_datetime, format = "%H:%M")
processed_df$dropoff_hrs <- format(strptime(processed_df$dropoff_time,"%H:%M"),'%H')
processed_df$dropoff_hrs_num <- as.numeric(processed_df$dropoff_hrs)
processed_df$dropoff_time_type <- ifelse(processed_df$dropoff_hrs_num >= 05 & processed_df$dropoff_hrs_num <= 11, "Morning",
            ifelse(processed_df$dropoff_hrs_num > 11 & processed_df$dropoff_hrs_num <= 16, "Afternoon",
            ifelse(processed_df$dropoff_hrs_num > 16 & processed_df$dropoff_hrs_num <= 21, "Evening", "Night")))
processed_df$dropoff_time_type <- as.factor(processed_df$dropoff_time_type)
processed_df$dropoff_time_type <- ordered(processed_df$dropoff_time_type, levels = c("Morning", "Afternoon", "Evening", "Night"))
```

##Trip_duration
```{r Trip_duration, include=TRUE, echo = FALSE}
processed_df$trip_duration_mins <- difftime(processed_df$dropoff_datetime, processed_df$pickup_datetime, units = "mins")

processed_df$trip_duration_mins1 <- floor(as.numeric(processed_df$trip_duration_mins))

boxplot(processed_df$trip_duration_mins1, col = c("#0000FF"))

duration_outliers <- boxplot(processed_df$trip_duration_mins1, col = c("#0000FF"))

processed_df = processed_df[!processed_df$trip_duration_mins1 %in% duration_outliers$out, ]

boxplot(processed_df$per_tip, col = c("#0000FF"))

str(processed_df)
```


## Normality check
```{r}
processed_df %>%
  ggplot(aes(per_tip)) +
  geom_histogram(aes(y =..density..),
                   colour = "black",
                   fill = "light blue") + stat_function(fun = dnorm, args = list(mean = mean(processed_df$per_tip), sd = sd(processed_df$per_tip)))
```

## EDA

```{r }

processed_df$passenger_count <- as.factor(processed_df$passenger_count)

processed_df %>%
  group_by(passenger_count) %>%
  count() %>%
  ggplot(aes(passenger_count, n, fill = passenger_count)) +
  geom_col() +
  scale_y_sqrt() +
  theme(legend.position = "none")

processed_df %>%
  ggplot(aes(VendorID, fill = VendorID)) +
  geom_bar() +
  theme(legend.position = "none")

```

EDA questions:
1. What places give max and min tip?
2. How is the tip amount varying?
3. What time of the day gives your more tip?
4. Distribution across count of passenger?
5. Distance and time variation in the trip?


```{r}
# Bar chart according to VendorID
processed_df %>% group_by(VendorID) %>% summarise(n = n(),average = mean(per_tip), min = min(per_tip),  max = max(per_tip))

ggplot(processed_df, aes(y=per_tip, group = VendorID)) +
  geom_boxplot(outlier.colour="red", outlier.shape=8,
                outlier.size=4)

hist(check_2$per_tip,probability=T, main="Histogram of normal
data",xlab="Approximately normally distributed data")
lines(density(check_2$per_tip),col=2)
```


```{r }
hist(processed_df$per_tip,probability=T, main="Histogram of normal
data",xlab="Approximately normally distributed data")
lines(density(processed_df$per_tip),col=2)


qqnorm(processed_df$per_tip)
qqline(processed_df$per_tip)

print(sd(processed_df$per_tip))

print(mean(processed_df$per_tip))
#per_tip_outliers
```


```{r boxplot_pertip, include = T, echo = F}

boxplot(processed_df$tip_amount)
boxplot(processed_df$per_tip)
```



```{r}
# TANAYA

# anova tests
anova_tip_amount = aov(per_tip ~ passenger_count, data = processed_df)
summary(anova_tip_amount)
```

####################################
# MADHURI

```{r include=TRUE, echo = FALSE}

ad.test(processed_df$per_tip)
qqnorm(processed_df$per_tip, main = "Q-Q plot of BMI", col = "pink")

hist(processed_df$per_tip,     main = "Histogram of plasma glucose concentration",    col = c('pink'))

```


```{r Pickup_time1, include=TRUE, echo = FALSE}

qqnorm(processed_df$pickup_hrs_num, main = "Q-Q plot of BMI", col = "skyblue")
hist(processed_df$pickup_hrs_num, main = "Histogram of plasma glucose concentration",    col = c('skyblue'))

boxplot(per_tip ~ pickup_time_type, data = processed_df, col = c("#BB81EE","#A255E5","#7C29C6","#6515AB"), main = "GPA ", xlab = "School Ranking", ylab = "GPA" )
```

```{r Pick_up_time_Anova, include=TRUE, echo = FALSE}

anova_pickup_time_type = aov(per_tip ~ pickup_time_type, data = processed_df)

summary(anova_pickup_time_type)
tukeyday_pickup_time_type <- TukeyHSD(anova_pickup_time_type)
tukeyday_pickup_time_type
plot(tukeyday_pickup_time_type)

```

p<0.05 hence we reject null hypothesis
null hyp = means for all the day types are equal
conclusion : Avg tip amt for diffrent time in the day is not equal
not all of the means are equal and the results are statistically significant



```{r Dropoff_time1, include=TRUE, echo = FALSE}
qqnorm(processed_df$dropoff_hrs_num, main = "Q-Q plot of BMI", col = "skyblue")
hist(processed_df$dropoff_hrs_num, main = "Histogram of plasma glucose concentration",    col = c('skyblue'))

boxplot(per_tip ~ dropoff_time_type, data = processed_df, col = c("#BB81EE","#A255E5","#7C29C6","#6515AB"), main = "GPA ", xlab = "School Ranking", ylab = "GPA" )
```

```{r Dropoff_time_Anova, include=TRUE, echo = FALSE}

anova_dropoff_time_type = aov(per_tip ~ dropoff_time_type, data = processed_df)

summary(anova_dropoff_time_type)
tukeyday_dropoff_time_type <- TukeyHSD(anova_dropoff_time_type)
tukeyday_dropoff_time_type
plot(tukeyday_dropoff_time_type)

```

p<0.05 hence we reject null hypothesis
null hyp = means for all the day types are equal
conclusion : Avg tip amt for diffrent time in the day is not equal
not all of the means are equal and the results are statistically significant



```{r Trip_duration1, include=TRUE, echo = FALSE}

hist(processed_df$trip_duration_mins1, processed_df$per_tip, main = "Histogram of PER_TIP vs tRIP DURATION", col = rainbow(40), breaks = 40)

```

```{r Trip_duration_Two_Sample_Ttest, include=TRUE, echo = FALSE}

a <- t.test(processed_df$per_tip, processed_df$trip_duration_mins1)
a

processed_df_num <- processed_df[, sapply(processed_df, is.numeric)]
processed_df_cor = cor(processed_df_num)
corrplot.mixed(processed_df_cor)
```

p<0.05 hence we reject null hypothesis
null hyp = means for per_tip and trip_duration_min are equal
conclusion : true difference in means is not equal to 0
means are not equal and the results are statistically significant

<<<<<<< HEAD
#Madhuri Ends
####################################
=======
>>>>>>> 29d0f71f0251384c4f2b8c5e24b3c721927ff061


### Tip payed vs distance travelled by passengers 

Variables...


Which test to perform and why?


Assumptions/Criteria to be fulfilled:
<ul>
  <li>Random sampling [data](https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page)
  <li>Normally distributed dependent variable (CLT)
  <li>Independence of observations
</ul>


First Step in Significance testing: 
<ul>
  <li>Null Hypothesis: H<sub>o</sub>  Average tip amount is same for both short and long distance passenger(s)
  <li>Alternate Hypothesis: H<sub>a</sub> Average tip amount is NOT same for both short and long distance passenger(s)
</ul>
```{r }

# AMNA

# i am going to work on 2 variable cols, dependent variable is tip_amount & independent variable is trip_distance so subsetting my variables into a new df
df_dist <- subset(processed_df, select=c(tip_amount, trip_distance))
glimpse(df_dist)


# Now that I know my variables, which test to choose. I cannot use z-test because I dont know population mean & std dev. cannot use one sample t-test because I dont have a pre-determined population mean or some other theoretically derived value with which i could compare the mean value of my observed sample.  

# Bimodal so divided it into 2 chunks for normalization

# So going to use independent two-sample t-test, a significance test that can give us an estimate as to whether different means between two groups are the result of random variation or the product of specific characteristics within the groups. So I divide my independent variable i.e. distances covered in miles during each ride into "two factored categorical data".
factor_dist <- cut(df_dist$trip_distance, breaks=c(0, mean(df_dist$trip_distance), Inf), labels= c("Shorter Distances","Longer Distances"), 1:2, sep="")
df_dist$trip_distance <- factor_dist   # assigning factored col to the original df
glimpse(df_dist)

# Lets have a look at them
# Basic histogram of tip variable
theme_update(plot.title = element_text(hjust = 0.5))   # once I run this line all chart titles onwards will be centered instead of default left-aligned
ggplot(df_dist, aes(x=tip_amount)) + 
  geom_histogram(binwidth=0.1, color="green") + coord_cartesian(xlim=c(0,20)) + 
  labs(x="Tips($)", y = "Count") + ggtitle("Histogram for Tip values")

# ?? Some of the values look like outliers and hence skewing the whole distributions so I am going to remove them from my dataset treating them as outliers ??

# Plot combining values from both of my variables
# Use semi-transparent (alpha=0.5) fill  ??how to change legend title??
p<-ggplot(df_dist, aes(x=tip_amount, fill=trip_distance, color=trip_distance)) +
  geom_histogram(binwidth=0.1, position="identity", alpha=0.5) + coord_cartesian(xlim=c(0,20)) + 
  labs(x="Tips($)", y = "Count") + ggtitle("Histogram of Tip values by Distance travelled") 
p
# Judging by the shape of this plot, I am unable to say whether there is a Relationship between these two variables or not.







# But before applying the 2 sampled t-test, I first need to fulfull some conditions for reliable results. i.e. random, normal, independent

# All set. Now the 1st step in significance testing is to state your hypothesis. Null: Average amount tipped by the passenger(s) travelling shorter distances equals that of longer distance travellers.

str(processed_df)    
# sample size is large enough approx 13,000 observations so CLT applies and we can say our data is normally distributed

# shapiro.test(processed_df$tip_amount)
# For Shapiro, sample size must be between 3 and 5000

summary(processed_df$per_tip)

summary(processed_df$trip_distance)

plot(processed_df$trip_distance, processed_df$tip_amount, main = "Scatter plot between Tip Amount & Distance travelled")
# not so good/visible results

plot(processed_df$trip_distance, processed_df$per_tip, main = "Scatter plot between Percentage Tip Amount & Distance travelled")
# even bad results, what to do
# plot(processed_df$trip_distance, processed_df$tip_amount, main = "Scatter plot between Percentage Tip Amount & Distance 
# travelled (Log)", log = processed_df$tip_amount) 
# should i take log etc

hist(processed_df$tip_amount, main="Tip Amount Histogram", xlab = "Tip ($)", col = "aquamarine")  
# not normal
hist(processed_df$per_tip, main="Tip Percentage Histogram", xlab = "Tip Percentage", col = "aquamarine")   
# pretty normal
hist(processed_df$trip_distance, main="Trip Distance (miles) Histogram", xlab = "Trip Distance (miles)", col = "aquamarine")
# not normal

qqnorm(processed_df$tip_amount, main="Normal Q-Q Plot for Tip Amount", xlab="Theoretical Quantiles (z-scores)", ylab="Tip values", col="darkviolet")    
qqline(processed_df$tip_amount)    
# end points digress

qqnorm(processed_df$per_tip, main="Normal Q-Q Plot for Tip Percentages", xlab="Theoretical Quantiles (z-scores)", ylab="Tip Percentage values", col="darkviolet")    
qqline(processed_df$per_tip)    
# much better results than simple tip amount

qqnorm(processed_df$trip_distance, main="Normal Q-Q Plot for Trip Distances", xlab="Theoretical Quantiles (z-scores)", ylab="Trip Distances values", col="darkviolet")    
qqline(processed_df$trip_distance)    
# same result as tip_amount, end points digress

# cannot perform Shapiro because observations (approx 13,000)  > 5000


mean_dist <- mean(processed_df$trip_distance)
# should i use mean or median bc this col in not normal




str(processed_df)

short_dist <- subset(processed_df, processed_df$trip_distance == "Distance1")
long_dist <- subset(processed_df, processed_df$trip_distance == "Distance2")
# subsetting df on basis of trip distance

# Applying 2 Sample t-test below
result <- t.test(short_dist$tip_amount, long_dist$tip_amount)
print(result)
# My Null Hyp = Both means equal, Alt Hyp = Both means not equal

plot(processed_df$per_tip ~ processed_df$trip_distance, data=processed_df , main="Tips paid by Short vs High Distance Commuters (Mean)", ylab="Tips Paid", xlab="Distance travelled", col=c("#ff0000","#00ff00") )
M = tapply(processed_df$per_tip,
           INDEX = processed_df$trip_distance,
           FUN   = mean)
points(M,
       col="yellow",
       pch="+",   ### symbol to use, see ?points
       cex=2)

# somewhat surprising results, above plot shows that mean tip paid by short-distance travellers is greater than long-distance travellers




```





####################################

### GEOGRAPHIC LOCATION AND TIP
As previously discussed, location can also impact the amount of tipping. This is because each location has its own set of customs and traditions and socioeconomic variables that affect tipping [1]. In this context, a person's wealth may also impact the amount that he or she tips to the taxi driver. While most of this analysis was done on a larger, regional scale, given the distinct culture of each borough in New York, there may be microcosims of tipping culture found in the city that differ between each borough.
The dataset does not provide information on the passenger's home location, wealth, or even purpose of travel; it simply provides pick up and drop off locations. However, pick up and drop off locations may provide some context into a passenger's background for two main reasons. The first reason is quite simple: Passengers may use taxis to go from home to work and from work to home [2]. Secondly, each individual has their own time-space geography. Some geographers have argued that people's time-spaces are often segregated--whether due to gender or race--which can affect their access to resources. Therefore, this may provide some context into how an individual lives.


[1] https://scholarship.sha.cornell.edu/cgi/viewcontent.cgi?referer=&httpsredir=1&article=1102&context=articles
[2] https://ieeexplore.ieee.org/abstract/document/4624004; https://onlinelibrary.wiley.com/doi/pdf/10.1111/0033-0124.00158?casa_token=fgUlwmzlofwAAAAA:k19TGhhaKN9uLpNH1QXQgXrqRrm77fEgGmBisvuspaVDzvnNfXkrcvBvC4QsJMOmptyw8ew-qJWCd4s; https://biblio.ugent.be/publication/3029997/file/6779790.pdf; https://www.tandfonline.com/doi/full/10.1080/02723638.2016.1142152

To better understand this issue, descriptive statistics were run. First, we calculate the number of trips in each borough, firstly grouped by pickup location and secondly grouped by drop off location.

```{r location_barlot, include = T, echo = F}
# Create boxplots for trip counts based on location
ggplot(data = processed_df, aes(x = Borough_pu, fill = Borough_pu)) + geom_bar() + ggtitle("Trip Counts Based on Pickup Location") + xlab("Location") + ylab("Trip Frequency")

# Create boxplots for trip counts based on location
ggplot(data = processed_df, aes(x = Borough_do, fill = Borough_do)) + geom_bar() + ggtitle("Trip Counts Based on Dropoff Location") + xlab("Location") + ylab("Trip Frequency")
```

These bar charts show that Manhattan has the highest number of both pick up and drop offs, followed by Queens and Brooklyn in second and third, respectively. We also looked at the frequency of various drop off and pick up combinations.

```{r combo_pu_df, include = T, echo = F}
# Subset data to get locations only
pu_do <- subset(processed_df, select = c("Borough_pu", "Borough_do"))

# Create table of location combinations
ddply(pu_do, .(Borough_pu, Borough_do), nrow)
```

This table shows that Manhattan to Manhattan has the highest number of trips, followed by Queens to Manhattan, Manhattan to Queens, and Manhattan to Brooklyn.

Considering the Manhattan and Queens have the highest number of pick ups and drop offs, the fact that the number of trips within and between these places are also the highest make sense. The fact that Manhattan scores the highest in both measurements is also reasonable because yellow taxis (the focus of this study) mainly serve Manhattan, whereas green taxis usually serve the other boroughs that have been traditionally underserved by taxis (SOURCE).

With these descriptive statistics in mind, we decided to compare the mean tipping percentage for each borough based on drop off and pick up location to see if they were statistically different.

We used the ANOVA test. Here are the results:

```{r anova_tip-percent_pu, include = T, echo = F}
# Run ANOVA
anova_tipper_pu <- aov(per_tip ~ Borough_pu, data = processed_df)

# Print ANOVA results
anova_tipper_pu

# Summarize ANOVA
summary(anova_tipper_pu)
```

```{r anova_tip-percent_do, include = T, echo = F}
# Run ANOVA
anova_tipper_do <- aov(per_tip ~ Borough_do, data = processed_df)

# Print ANOVA results
anova_tipper_do

# Summarize ANOVA
summary(anova_tipper_do)
```

```{r tipper_plot, include = T, echo = F}
# Plot tip percentage by pickup location
ggplot(data = processed_df, aes(x = Borough_pu, y = per_tip, fill = Borough_pu)) + ggtitle("Tip Percentage by Pickup Location") + geom_boxplot() + xlab("Location") + ylab("Tip Percentage")

# Plot tip percentage by dropoff location
ggplot(data = processed_df, aes(x = Borough_do, y = per_tip, fill = Borough_do)) + ggtitle("Tip Percentage by Dropoff Location") + geom_boxplot() + xlab("Location") + ylab("Tip Percentage")
```

The p-values are `r summary(anova_tipper_pu)[[1]][["Pr(>F)"]][[1]]` and `r summary(anova_tipper_do)[[1]][["Pr(>F)"]][[1]]` for pick up and drop off, respectively. Both of these are smaller than a significance level of 0.05 (a 0.95 confidence level). Thus, we can reject the null hypothesis that the means are the same and say the means are statistically different at a significance level of 0.05.

Because they are significant, the next step would be to conduct a Tukey's HSD test, which looks at each pair of variables to see if they are significantly different. Here are the results from that analysis:

```{r tipper_tukey, include = T, echo = F}
# Conduct Tukey test for tip percentage vs pickup
tukey_tipper_pu <- TukeyHSD(anova_tipper_pu, conf.level = 0.95)

# Print Tukey test
tukey_tipper_pu

# Conduct Tukey test for tip percentage vs dropoff
tukey_tipper_do <- TukeyHSD(anova_tipper_do, conf.level = 0.95)

# Print Tukey test
tukey_tipper_do
```

While the means are overall not the same, the following pick up pairs have significant differences in tipping percentage (excluding Unknown) given their small p-values: Manhattan and Brooklyn, and Queens and Manhattan. For drop off pairs, Manhattan and Bronx, Manhattan and Brooklyn, and Manhattan and Queens are significant.

ANOVA assumes a normal distribution, and as previously highlighted, the tipping amount is not necessarily normally distributed. Nonetheless, a look at the tipping amount can provide some context to the situation. We compared the mean tipping amount for each borough to see if those were statistically different. Here are the results for raw tip amount based on location:

```{r anova_tip-amt_pu, include = T, echo = F}
# Run ANOVA
anova_tipamt_pu <- aov(tip_amount ~ Borough_pu, data = processed_df)

# Print ANOVA results
anova_tipamt_pu

# Summarize ANOVA
summary(anova_tipamt_pu)
```

```{r anova_tip-amt_do, include = T, echo = F}
# Run ANOVA
anova_tipamt_do <- aov(tip_amount ~ Borough_do, data = processed_df)

# Print ANOVA results
anova_tipamt_do

# Summarize ANOVA
summary(anova_tipamt_do)
```

```{r tipamt_plot, include = T, echo = F}
# Plot tip amount vs pickup location
ggplot(data = processed_df, aes(x = Borough_pu, y = tip_amount, fill = Borough_pu)) + ggtitle("Tip Amount by Pickup Location") + geom_boxplot() + xlab("Location") + ylab("Tip Amount")

# Plot tip amount vs dropoff location
ggplot(data = processed_df, aes(x = Borough_do, y = tip_amount, fill = Borough_do)) + ggtitle("Tip Amount by Dropoff Location") + geom_boxplot() + xlab("Location") + ylab("Tip Amount")
```

For these ANOVA analyses, the null hypothesis is that all means for different locations are the same. The p-values are `r summary(anova_tipamt_pu)[[1]][["Pr(>F)"]][[1]]` and `r summary(anova_tipamt_do)[[1]][["Pr(>F)"]][[1]]` for pick up and drop off, respectively. Both of these are smaller than a significance level of 0.05 (a 0.95 confidence level). Thus, we can reject the null hypothesis that the means are the same and say the means are statistically different at a significance level of 0.05.

As with the previous, because both are significant, we can run Tukey's HSD test:

```{r tipamt_tukey, include = T, echo = F}
# Conduct Tukey test for tip amount vs pickup
tukey_tipamt_pu <- TukeyHSD(anova_tipamt_pu, conf.level = 0.95)

# Print Tukey test
tukey_tipamt_pu

# Conduct Tukey test for tip amount vs pickup
tukey_tipamt_do <- TukeyHSD(anova_tipamt_do, conf.level = 0.95)

# Print Tukey test
tukey_tipamt_do

```

For pick up locations, there is no statistical difference for the between the following pairs (excluding Unknown) given their large p-values: Brooklyn and Bronx, and Manhattan and Bronx. For drop off locations, there is no difference for: Queens and Bronx, Staten Island and Bronz, Staten Island and Brooklyn, Staten Island and EWR, and Staten Island and Queens. All the Manhattan drop off locations are significant.

Based on this analysis, it seems that being dropped off in Manhattan is significantly different from being dropped off in another location. The same seems to be true for being picked up in Manhattan. FINISH THIS


<<<<<<< HEAD
``` {r}
# Fit linear model with 3 variables
lm_3var <- lm(per_tip ~ Borough_pu, data = processed_df)

# Print summary
summary(lm_3var)
```
=======
>>>>>>> 29d0f71f0251384c4f2b8c5e24b3c721927ff061

# Limitations
One limitation was hardware limitations.
Another limitation was that cash tips by nature are not documented.
Also, as previously discussed, our data was not perfectly normally distributed. While it was roughly normal, not being normally distributed may slightly contradict some of the assumptions of the statistical analyses.

# Future Considerations
We might have to do just an analysis on the neighborhoods within Manhattan since yellow taxis are mainly found in Manhattan. Or, we could combine the yellow taxi data with green taxi data to do an analysis that encompasses all five boroughs.


# Conclusions
